___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Firework Purchase Tracking",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "Video commerce built to last. Transforming brand and consumer relationships one video at a time.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const injectScript = require('injectScript');
const queryPermission = require('queryPermission');
const copyFromWindow = require('copyFromWindow');
const log = require('logToConsole');
const callInWindow = require('callInWindow');
const url = "https://asset.fwcdn3.com/js/analytics.js";
const copyFromDataLayer = require('copyFromDataLayer');

function onFailure (){
  log('FireWork Script load failed.');
  data.gtmOnFailure();
}

function onSuccess () {
  var DataFw = {};

  if (copyFromDataLayer('order_id') != undefined) DataFw.order_value = copyFromDataLayer('order_value');
  if (copyFromDataLayer('order_id') != undefined) DataFw.order_id = copyFromDataLayer('order_id');
  if (copyFromDataLayer('order_value') != undefined) DataFw.order_value = copyFromDataLayer('order_value');
  if (copyFromDataLayer('currency') != undefined) DataFw.currency = copyFromDataLayer('currency');
  if (copyFromDataLayer('subtotal') != undefined) DataFw.subtotal = copyFromDataLayer('subtotal');
  if (copyFromDataLayer('shipping_price') != undefined) DataFw.shipping_price = copyFromDataLayer('shipping_price');
  if (copyFromDataLayer('country') != undefined) DataFw.country = copyFromDataLayer('country');
  
  if (queryPermission('access_globals', 'execute', '_fwn.analytics.purchase')) {
    callInWindow("_fwn.analytics.purchase", DataFw);
  } else {
    log("You probably need to give permission!");
  }
  data.gtmOnSuccess();
}

if (queryPermission('inject_script', url)) {
  injectScript(url, onSuccess, onFailure);
} else {
  log('Error.');
  data.gtmOnFailure();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://asset.fwcdn3.com/js/analytics.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_fwn"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_fwn.analytics.purchase"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_fwn.analytics"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_fwn.version"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_data_layer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keyPatterns",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "order_id"
              },
              {
                "type": 1,
                "string": "order_value"
              },
              {
                "type": 1,
                "string": "currency"
              },
              {
                "type": 1,
                "string": "subtotal"
              },
              {
                "type": 1,
                "string": "shipping_price"
              },
              {
                "type": 1,
                "string": "country"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Quick Test
  code: runCode();
setup: ''


___NOTES___

Created on 19/10/2023, 20:53:24


